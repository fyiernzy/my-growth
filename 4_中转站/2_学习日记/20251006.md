6 October

1. WebClient config + Setup
    1. Study others’ code (regional-fast, digital-service)
    2. Study chatGPT code and combine
    3. Rate limiting
    4. Observability
    5. How to write one

Use WebClient + chatGPT first, then only proceed to use others’ code.

notificationServiceWebClient

Now: Focus on how to use WebClient & Configuration & Justification

Solution Design for Gateway & Security & Implementation
Conventions come laters

At 3:22p.m.:
- Security & Gateway (Convention &Technical Specifications)
    1. Type: Generator
        1. TokenSettings/ ClientSettings Generator
        2. Generate SQL from RegisteredClient
        3. Generate RegisteredClient from SQL
        4. Generate Client Secret/ Encryption
        5. Constants: Default Token Setting
- SecurityWebFilterChain (Study & SD + Research + Restrictions)
    - Documentation & Findings
    - Opaque + SecurityWebFilterChain + authenticate

Today’s Work
- Logging Testing for WebClient + FeignClient
- Introduction to Spring’s Dependency Injection
- Security Documentation

Technical Specifications
- Introduction to iFastPay Gateway
    - Preface: Assume a Year 1 Intern comes and read the document, so this document will be self-contained to make sure everyone can understand without further help.
    - Document change history
    - Introduction to Spring Cloud Gateway
        - What are the two types of Spring Cloud Gateway and why we’re using the current one?
        - The internal mechanism of Spring Cloud Gateway
        - The core concepts of Spring Cloud Gateway (Predicates, Filters, URI)
        - What are the existing ways for writing configuration
    - iFastPay Gateway Design Explanation
    - Introduction to existing filters & utilities
        - RequestAccessor
        - ErrorResponseWrapper & ErrorResponseWrappers
        - Exchange Mutator
        - JsonUtils
        - HeaderUtils
        - Base64Utils
        - CryptoUtils
    - Error Handling (GlobalErrorAttributes)
    - Convention/ Preference
        - EnableGatewaySupport
        - How to write the configuration (YAML > Programmatic)
        - How to write a Util class
        - How to write a custom gateway filter
        - How to write a custom global filter
        - When to define the business-related filters?
        - How to call external services? (Refer to WebClient & HttpExchange Technical Specifications)
        - Reusing existing gateway filters
        - Gateway Filters are components
        - Global Filters should be imported
        - Constants (Naming Conventions, Where to locate, etc., why naming so).
    - Miscellaneous
        - Observability
            - What are provided out of the box
            - What can’t be added so far and why
            - SBOM
        - Security: Covered 

- Introduction to HTTP Calls
    - RestClient & FeignClient
    - WebClient & HttpExchange
        - Why we should use WebClient?
        - Why we’re going to use @HttpExchange?
        - Convention
            - How to define a WebClient
            - How to define a WebClient.Builder
            - How to define a Path Constants and why
            - Why using an Adapter Pattern
            - What are the Naming Conventions and Why stressing it (Why Stressing, What naming, why such naming)
    - General Topics
        - Resilience: Retry & Idempotency, Timeout/Time Limiter, Circuit Breaker, Rate-Limiting, Fallback
        - Security
        - Observability

- Introduction to Spring’s Dependency Injection
    - Convention over Configuration
    - @Configuration and @Bean
    - Constructor Dependency Injection vs Field Level Dependency Injection
    - Convention when writing @Configuration and @Bean
        - Use bean name carefully & Why
        - Avoid using @Qualifier
        - Convention when using @Bean and @Qualifier
        - No class-level DI on @Configuration class; Only method-level @Bean is allowed.
    - Techniques
        - Debugger & Debugging

- Introduction to Spring’s Filters
    - The differences between Servlet Filters and Spring’s Self-Managed Filters
    - What are the differences OncePerRequestFilter, Filter, GenericBeanFilter (+ What if we didn’t use these)
    - Why do we need FilterRegistrationBean?

- Introduction to iFastPay’s Security
    - Reference: 
        - Introduction to Spring’s IoC Containers (DI & Bean Initialization)
        - Introduction to Java Security Algorithms
        - Introduction to Spring’s Filters
    - Introduction to Spring SecurityFilterChain (Official Guide)
    - How to write a SecurityFilterChain?
        - .securityMatcher()
        - .authorizeHttpRequest()
        - .exceptionHandling()
        - .csrf()
        - .cors()
        - formLogin()
        - resourcesServer
    - OAuth2.0 Authentication
    - Authentication and Authorization in Spring Security
        - Authentication
            - Username and Password
        - Authorization
    - Studying the Legacy Code from FSM, iGB and iGV
        - OAuthAuthenticationFilter
        - OAuth2 url
        - AntPathMatchers
        - Writing Style
    - Convention
        - Defining multiple SecurityFilterChain
        - How to define a SecurityFilterChain?
        - Why do we need to define multiple SecurityFilterChain?
        - How to define a filter for SecuerityFilterChain?
        - How to manage the dependencies of a SecurityFilterChain?
    - Utils
        - RequestMatcherUtils
- Introduction to iFastPay’s Observability
    - Logging
    - Metrics
    - Tracing

- Introduction to Java Security Algorithms

- Discussion on SpringBoot 3.X and Java 21 new features
    - Text Block
    - Pattern Matching
    - Record
    - Virtual Threads
    - List.of, 
    - ImmutableCollections
    - Stream
    - Optional
    - Functional Programming
    - DRY








Today’s Job
- Gateway
    - [x] Observability (OpenFeign + HOP Testing) - Testing & Debug
    - SecurityWebFilterChain (Study & SD + Research + Restrictions)
        - Documentation & Findings
        - Opaque + SecurityWebFilterChain + authenticate
    - Documentation & Convention
- Security
    - Documentation + Research
        - [x] In the document, provide the exact version of Spring Security, SpringBoot, Spring Cloud Gateway, Spring Authorisation Server, Spring OAuth Client, Spring OAuth Resource version to be used.
        - Study the available algorithms and the industrial standard for client secret generation and encryption with its configuration setup.
        - [x] Include any RFC/ OWASP/ OAuth2.0 resources to improve the credibility.
        - [x] API Specification (What are exposed, what are hidden, how they are hidden, justification and explanation).
        - [x] Token Settings & Client Settings & Justification (Default, Stricter, Looser) 
        - [x] How IAM service can be provided and what’s its roles.
        - Guideline/ Study
            - [x] Draw a Sequence Diagram to illustrate how other internal services and external services could request for the token (Create/ Refresh Token
                - Client Side
                - Internal Mechanism Study
            - Encryption Algorithm & Study
        - Solution Design/ Convention/ Guideline/ Demo
            - How to perform changes to SecurityFilterChain
            - What are the convention available and why.

1. Code
    1. Type: Generator
        1. TokenSettings/ ClientSettings Generator
        2. Generate SQL from RegisteredClient
        3. Generate RegisteredClient from SQL
        4. Generate Client Secret/ Encryption
        5. Constants: Default Token Settings
    2. Type: Util

- [ ] ApiLog (Masking/ Encryption of Sensitive Field (How to reuse existing ApiLog))
- [ ] Testing
- [ ] Ifastpay integration (Wii Documentation & Convention & Requirements)
    1. Resilience (Retry, Rate-Limtiing, Circuit-Breaker) - Low Priority

Till 2:25p.m.
- 完成了 WebClient 和 HttpExchange 的基础配置、约定（Convention）和测试。目前可以成功使用。
    - 决策 1：使用 ApiService 和 ApiServiceImpl 在技术层面进行解耦，允许 ApiServiceImpl 直接使用 WebClient 进行手动微调或者 HttpExchange 结合 HttpServiceProxyFactory 简化开发流程。
    - 决策 2：把 regional-ifast（IGV）的 WebClient 代码拆分成 WebClientConfig，WebClientBuilderConfig 以及其他，如 ReactorConnectionPoolConfig, OAuth2Config 等，并完善了相关约定（Convention），达成 Separation of Concern
    - 产出：完善了 WebClient 和 HttpExchange 相关的约定，并写成了文档。
    - Debug：采用了Temporary Fix 修复了 OAuth2 Server 的 Client Registration

