29 Sep
What’s needed by the current project?
- Task: Gateway
    - It seems to depend on how the solution design might look like. So we’ll still need a solution design on how our side should deal with third parties.
    - Despite relying on the responses from third parties, I can refer to IGB and IGV for their overall design first, including how they setup, and the filters available.
    - So this week focus: Solution Design for Gateway.
        - Study IGV and IGV code
        - prepare a diagram on how the system should be designed, 
        - prepare a list of filters (gateway, global) that can be used and how they can be designed
        - Solution Design (Existing Architecture, Existing filters)
        - High value but low priority: other considerations (brainstorming  from chatGPT), e.g. Rate Limiting, etc.
- Task: Security
    - Current need:
        - Confidential Client Authentication
        - User authentication
    - For user authentication, need to follow up with SecOps team and can start study the code and document the changes.
    - For Confidential Client Authentication, can prepare a comprehensive solution design for the review and start implementing it in the ifastpay. Can have a section for explaining the changes to be made.
    - High value but low priority: Authorization (more granular)

What should I do for this week?
- Outcome: Gateway Solution Design
    - Study IGV/IGB code for Gateway design, focusing mainly on their interaction and filters (gateway, global) available.
    - Diagram: How IGV and IGB deals with third parties
    - Table: Built-in Spring Gateway filters (cheatsheet), and filters used in IGV/IGB (filter functions, existing design)
    - Solution design:
        - A framework for filters setting.
        - Proposed solution for filters (global, gateway) design + Justification + Demo
        - Proposed solution for design + Justification
- Outcome: Security Solution Design (Confidential Client Authentication, user authentication still pending confirmation)
    - Solution Design
        - Previous Comparison (simpler one)
        - Basic authentication mechanism
        - Setup needed (SFC)
        - Proposed files organization with demo

What should I do for today?
- Task: Security Solution Design (Confidential Client Authentication)
    - [x] Authentication Mechanism
    - [x] Previous Comparison with more essential details
    - [x] Setup required & Endpoints exposed/ not exposed and justification
    - [x] Proposed files organization with demo.

Validation
- What should I do? (Up until 4:00p.m.)
    - Study the code (iGB, iGV, ifast3.0, ifastpay) to know what validator has responsible for.
    - Propose solution & Test on solution
    - Compile a refactor document

Gateway Solution Design (4:10p.m. - 5:15p.m.)
- Spring’s built-in gateway/global filters
- iGB & iGV gateway/global filters
- iGV/iGB current gateway architecture diagramCo


From 9:45a.m., End: 11:52a.m., Est. duration: 1:45:00
- Complete Solution Design for Internal Service Authentication
    - Authentication Mechanism: 学习了原来我用的一直是 JWT Authentication；用 chatGPT + PlantUML 生成 Sequence Diagram。
    - Comparison-1: 总结了我对 SQL-based/ YAML-based Client Registration 的理解，并用 chatGPT 润色
    - Comparison-2: 汇总了 SQL-based/YAML-based 所需要的 Configuration，也参考了其他codebase (my-ifast-3.0, digital-bank, regional-ifast) 的代码
    - 写出了自己对 Configuration as Code 的配置

From 2:00p.m., End: 5:05p.m., Est duration: 2:30:00
- Complete Validation Refactor Demo
    - ErrorCode 处理：下午头脑没那么清楚，只用 chatGPT 快速写了个 ErrorCodeRegistrar/EnableErrorCodeRegistry 验证思路，部分处理方式我不是很喜欢；也写了 ErrorCodeRegistry 用来注册这些 Error Code
    - GlobalExceptionHandler
        - 写了 AbstractValidator 和 NotBlankValidator 来处理 @NotBlank 验证的逻辑；通过 AbstractValidator 简化常用操作。
        - 处理了 MethodArgumentNotValidException 和 ConstraintValidationException 的逻辑；并使用了 ProblemDetail 和 ErrorResponse 作为返回结果；也为 error message 设置了 Fallback。
    - 特别尝试：使用了 Lombok 的 @Delegate （to HttpServletRequest) 和 @RequestScope 的 RequestInfo 并在 GlobalExceptionHandler 里面调用了，特别舒服，比使用 Util class 或者手写 Delegate Pattern 还要轻松方便许多 ：）
- 复盘：
    - 善加使用 Debug Mode，而不是 if-else System.out.println

What I want to do but it’s not suitable for today?
- Task: Validation (better validation)
    - Justification:
    - Idea:
- Task: Study how to define properties in YAML properly (OAuth2AuthorizationServerProperties)

- 
